# Nexus EROFS Snapshotter Configuration Example
#
# Copy this file to /etc/nexuserofs-snapshotter/config.toml and modify as needed

version = 1

[snapshotter]
# Root directory for snapshotter data (layer blobs, metadata)
root = "/var/lib/nexuserofs-snapshotter"

# Unix socket address for gRPC server
address = "/run/nexuserofs-snapshotter/snapshotter.sock"

# containerd socket for content store access
containerd_address = "/run/containerd/containerd.sock"
containerd_namespace = "default"

[snapshotter.options]
# Size of the ext4 writable layer for each container.
# An ext4 image of this size is created and loop-mounted for the overlay upperdir.
# Must be > 0. Common values: "64M", "256M", "1G"
default_writable_size = "1G"

# Enable fsverity for layer integrity validation
# Requires kernel 5.4+ and filesystem support
enable_fsverity = false

# Set IMMUTABLE_FL flag on committed layers
# Prevents accidental modification of layer blobs
set_immutable = true

# Extra overlay mount options
# Common options: index=off, metacopy=off, userxattr
overlay_options = ["index=off", "metacopy=off"]

# Layer count threshold for triggering fsmerge (must be >= 5)
# Layers are merged when count exceeds this threshold
# Requires mkfs.erofs with --aufs support
max_unmerged_layers = 5

[differ]
# Extra mkfs.erofs options for layer conversion
# Common options:
#   -zlz4hc,12  = LZ4HC compression level 12
#   -zzstd      = Zstandard compression
#   -C65536     = Chunk size for inline data
mkfs_options = ["-zlz4hc,12", "-C65536"]


[logging]
# Log level: debug, info, warn, error
level = "info"
